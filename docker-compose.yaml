  services:
    nginx:
      build: ./nginx
      container_name: nginx
      ports:
        - "8080:80"
      volumes:
        - ./nginx/nginx.conf:/etc/nginx/nginx.conf:rw
        - ./nginx/html:/usr/share/nginx/html:rw
        - ./nginx/logs:/var/log/nginx:rw
      restart: unless-stopped

    fail2ban:
      build: ./fail2ban
      container_name: fail2ban
      network_mode: host
      cap_add:
        - NET_ADMIN
      volumes:
        - ./fail2ban/fail2ban.log:/var/log/fail2ban.log:rw
        - ./nginx/logs:/var/logs/nginx:ro
        - ssh_logs:/logs/ssh:ro
      depends_on:
        - nginx
        - sshd
      restart: unless-stopped

    sshd:
      build: ./sshd
      container_name: sshd
      ports:
        - "2222:22"
      volumes:
        - ssh_logs:/var/log
      restart: unless-stopped

  volumes:
    nginx_logs:
    ssh_logs:
